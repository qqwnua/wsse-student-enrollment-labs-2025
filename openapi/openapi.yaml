openapi: "3.0.0"
info:
  title: "Student Enrollment API"
  version: "0.2.0"
servers:
  - url: "https://api.example.edu/api/v1"

# 這裡定義全域安全，預設所有 API 都要讀取權限
security:
  - CognitoOAuth2: [students.read]

paths:
  /health:
    get:
      summary: "Health check"
      description: "公開端點，不需要登入"
      # 覆寫：這裡設為空陣列，代表「匿名可存取」
      security: [] 
      responses:
        "200":
          description: "OK"

  /students:
    get:
      summary: "List students"
      description: "需要 students.read 權限 (沿用全域設定)"
      responses:
        "200":
          description: "ok"
    post:
      summary: "Create student"
      description: "寫入資料，需要 students.write 權限"
      # 覆寫：這裡特別要求 write 權限
      security:
        - CognitoOAuth2: [students.write]
      responses:
        "201":
          description: "Created"
          headers:
            Location:
              description: "URL of created resource"
              schema: 
                type: string
                example: "/api/v1/students/102"

components:
  securitySchemes:
    CognitoOAuth2:
      type: oauth2
      flows:
        authorizationCode:
          authorizationUrl: "https://wsse-lab2-411177029.auth.us-east-1.amazoncognito.com/oauth2/authorize"
          tokenUrl: "https://wsse-lab2-411177029.auth.us-east-1.amazoncognito.com/oauth2/token"
          scopes:
            # 這裡要跟截圖 04 的 Identifier/Scope 一模一樣
            api://students/students.read: "Read student data"
            api://students/students.write: "Create/modify student data"
